<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ë„ì‹œìœ„ì›íšŒ ì£¼ë¬¸ ë©”ëª¨</title>
    <style>
        /* CSS ë³€ìˆ˜ ì„¤ì • */
        :root {
            --bg: #f8fafc;
            --line: #e2e8f0;
            --text: #0f172a;
            --accent: #0f172a;
            --red: #fca5a5;
            --red-bg: #fee2e2;
        }

        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, sans-serif;
            margin: 0;
            padding: 16px;
            background: var(--bg);
            color: var(--text);
        }

        h1 { font-size: 24px; margin-top: 0; }
        h2 { font-size: 16px; margin-top: 18px; margin-bottom: 8px; }

        header {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        header .spacer { flex: 1; }

        input[type="text"], textarea, button {
            padding: 8px;
            border: 1px solid var(--line);
            border-radius: 8px;
            font-size: 14px;
        }
        
        button {
            background: #fff;
            cursor: pointer;
            transition: background 0.2s;
        }

        button:hover { background-color: #f1f5d9; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid var(--line);
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }
        th { background: #f1f5f9; }

        .pill-row { margin-bottom: 6px; }
        .pill {
            border: 1px solid var(--line);
            background: #fff;
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 12px;
            cursor: pointer;
            margin: 2px 2px 0 0;
            display: inline-block;
        }
        .pill.on {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }
        .pill.on:hover {
            background: var(--accent);
            opacity: 0.9;
        }
        
        textarea {
            width: 100%;
            height: 260px;
            border: 1px solid var(--line);
            border-radius: 8px;
            padding: 10px;
            font-size: 14px;
            resize: vertical; /* ì„¸ë¡œ í¬ê¸° ì¡°ì ˆ ê°€ëŠ¥ */
        }
        
        .reset-btn {
            background: var(--red-bg);
            border-color: var(--red);
        }
        .reset-btn:hover { background: #ffdada; }
        
        .copy-btn {
            background: #d1fae5;
            border-color: #34d399;
            margin-top: 8px;
        }
        .copy-btn:hover { background: #b0f5d7; }
        
        .notes-input { width: calc(100% - 10px); }
        .menu-input { margin-top: 5px; width: calc(100% - 10px); }
        
        /* New styles for the button group */
        #store-links {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .store-pill {
            border: 1px solid var(--line);
            background: #fff;
            border-radius: 999px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
        }
        .store-pill.on {
            background: var(--red-bg);
            border-color: var(--red);
        }
        .menu-info-buttons {
            display: flex;
            gap: 8px;
        }

        #addPersonContainer {
            margin-bottom: 12px;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        #newPersonInput {
            flex: 1;
            display: none;
        }
    </style>
</head>
<body>
    <h1>ë„ì‹œìœ„ì›íšŒ ì£¼ë¬¸ ë©”ëª¨</h1>
    <header>
        <label>ê°€ê²Œ ì´ë¦„&nbsp;<input id="store" type="text" placeholder="ê°€ê²Œ ì´ë¦„/ìœ„ì¹˜" /></label>
        <span class="spacer"></span>
        <button id="resetBtn" class="reset-btn">RESET</button>
    </header>

    <h2>ìì£¼ ì‹œí‚¤ëŠ” ê°€ê²Œ</h2>
    <div id="store-links">
        <button id="sigolCoffeeBtn" class="store-pill">ì‹œê³¨ì»¤í”¼</button>
        <div id="sigolCoffeeButtons" class="menu-info-buttons" style="display:none;">
            <a href="tel:01094938625"><button>ğŸ“ ì „í™”ê±¸ê¸°</button></a>
            <a href="https://m.place.naver.com/restaurant/1706757281/menu/list" target="_self"><button>ğŸ“± ë©”ë‰´íŒë³´ê¸°</button></a>
        </div>
        
        <button id="shinsongSushiBtn" class="store-pill">ì‹ ì†¡ì´ˆë°¥</button>
        <div id="shinsongSushiButtons" class="menu-info-buttons" style="display:none;">
            <a href="tel:0512064228"><button>ğŸ“ ì „í™”ê±¸ê¸°</button></a>
            <button id="shinsongSearchBtn">ë„¤ì´ë²„ ê²€ìƒ‰</button>
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>ì´ë¦„</th>
                <th>ë©”ë‰´</th>
                <th>ë¹„ê³ </th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

    <div id="addPersonContainer">
        <button id="addPersonBtn">ğŸ‘¤ ì¸ì› ì¶”ê°€</button>
        <input type="text" id="newPersonInput" placeholder="ì¶”ê°€í•  ì´ë¦„ ì…ë ¥ í›„ ì—”í„°" />
    </div>

    <h2>ì£¼ë¬¸ ìš”ì•½</h2>
    <textarea id="summary" readonly></textarea>
    <button id="copyBtn" class="copy-btn">ğŸ“‹ í´ë¦½ë³´ë“œì— ë³µì‚¬í•˜ê¸°</button>

<script>
(function(){
    const STORAGE_KEY = "committee-order-memo-v15";
    const DEFAULT_NAMES = ["ìœ„ì›ì¥", "ìœ ë™ì² ", "ìœ ì˜í˜„", "ì¥ì¬í¬", "ì‹ í˜„ìˆ˜", "ì „ì˜ì• ", "ë°•ì •ìˆœ", "ê³¼ì¥", "ê³„ì¥", "ì´ìƒì¤€", "ì–‘ì§„ì˜", "ê¹€ì§€í˜œ"];
    let NAMES = [...DEFAULT_NAMES];
    
    const MENUS = {
        "ì‹œê³¨ì»¤í”¼": {
            cats: ["ë¯¸ì„ íƒ", "ì•„ë©”ë¦¬ì¹´ë…¸", "ë¼ë–¼", "ë ˆëª¬í‹°", "ì‰ì´í¬", "ë””ì¹´í˜ì¸"],
            temps: ["ë¯¸ì„ íƒ", "í•«", "ì•„ì´ìŠ¤"]
        },
        "ì‹ ì†¡ì´ˆë°¥": {
            cats: ["ë¯¸ì„ íƒ", "ìƒëŒ€êµ¬íƒ•", "ìƒíƒœíƒ•", "ëŒ€êµ¬íƒ•", "ì¡°ê¸°íƒ•", "ì•Œíƒ•", "íšŒë®ë°¥", "ìƒì„ ì´ˆë°¥"],
            temps: ["ë¯¸ì„ íƒ"],
            prices: {
                "ìƒëŒ€êµ¬íƒ•": 18000,
                "ìƒíƒœíƒ•": 18000,
                "íšŒë®ë°¥": 18000,
                "ìƒì„ ì´ˆë°¥": 18000,
                "ëŒ€êµ¬íƒ•": 15000,
                "ì¡°ê¸°íƒ•": 15000,
                "ì•Œíƒ•": 15000
            }
        }
    };
    
    let state = {};

    const storeEl = document.getElementById("store");
    const tbody = document.getElementById("tbody");
    const summary = document.getElementById("summary");
    const resetBtn = document.getElementById("resetBtn");
    const copyBtn = document.getElementById("copyBtn");
    
    const sigolCoffeeBtn = document.getElementById("sigolCoffeeBtn");
    const sigolCoffeeButtons = document.getElementById("sigolCoffeeButtons");
    const shinsongSushiBtn = document.getElementById("shinsongSushiBtn");
    const shinsongSushiButtons = document.getElementById("shinsongSushiButtons");
    const shinsongSearchBtn = document.getElementById("shinsongSearchBtn");
    
    const addPersonBtn = document.getElementById("addPersonBtn");
    const newPersonInput = document.getElementById("newPersonInput");

    function saveState() {
        state.lastAccess = new Date().getTime();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadState() {
        try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) {
                const loadedState = JSON.parse(raw);
                const lastAccess = loadedState.lastAccess || 0;
                const currentTime = new Date().getTime();
                const oneDay = 24 * 60 * 60 * 1000;

                if (currentTime - lastAccess > oneDay) {
                    return defaults();
                }
                
                return loadedState;
            }
        } catch(e) {
            console.error("Failed to load state from localStorage", e);
        }

        return defaults();
    }

    function defaults() {
        NAMES = [...DEFAULT_NAMES];
        const orders = {};
        NAMES.forEach(n => orders[n] = { cat: "ë¯¸ì„ íƒ", item: "", temp: "ë¯¸ì„ íƒ", notes: "" });
        
        orders["ìœ„ì›ì¥"] = { cat: "ì•„ë©”ë¦¬ì¹´ë…¸", item: "", temp: "ì•„ì´ìŠ¤", notes: "" };
        orders["ìœ ë™ì² "] = { cat: "ë ˆëª¬í‹°", item: "", temp: "í•«", notes: "" };
        orders["ìœ ì˜í˜„"] = { cat: "ì•„ë©”ë¦¬ì¹´ë…¸", item: "", temp: "ì•„ì´ìŠ¤", notes: "" };
        orders["ì´ìƒì¤€"] = { cat: "ì•„ë©”ë¦¬ì¹´ë…¸", item: "", temp: "ì•„ì´ìŠ¤", notes: "" };
        orders["ê³¼ì¥"] = { cat: "ë””ì¹´í˜ì¸", item: "", temp: "ì•„ì´ìŠ¤", notes: "" };
        
        return { 
            store: "ì‹œê³¨ì»¤í”¼", 
            orders, 
            menu: MENUS["ì‹œê³¨ì»¤í”¼"], 
            extraNames: [],
            lastAccess: new Date().getTime()
        };
    }

    function render() {
        buildTable();
        updateSummary();
    }

    function createPill(label, active, onClick) {
        const b = document.createElement("button");
        b.className = "pill" + (active ? " on" : "");
        b.textContent = label;
        b.addEventListener("click", onClick);
        return b;
    }

    function buildTable() {
        tbody.innerHTML = "";
        NAMES.forEach(n => {
            const o = state.orders[n] || { cat: "ë¯¸ì„ íƒ", item: "", temp: "ë¯¸ì„ íƒ", notes: "" };
            const tr = document.createElement("tr");

            const tdName = document.createElement("td");
            tdName.textContent = n;
            tr.appendChild(tdName);

            const tdMenu = document.createElement("td");
            
            const catRow = document.createElement("div");
            catRow.className = "pill-row";
            state.menu.cats.forEach(c => catRow.appendChild(createPill(c, o.cat === c, () => {
                o.cat = c;
                if(state.store === "ì‹ ì†¡ì´ˆë°¥") {
                    o.temp = "ë¯¸ì„ íƒ";
                    o.item = "";
                }
                state.orders[n] = o;
                saveState();
                render();
            })));
            tdMenu.appendChild(catRow);

            const item = document.createElement("input");
            item.type = "text";
            item.className = "menu-input";
            item.placeholder = "ì„¸ë¶€ ë©”ë‰´ (ì˜ˆ: ë°”ë‹ë¼ ë¼ë–¼)";
            item.value = o.item;
            item.addEventListener("input", () => {
                o.item = item.value;
                state.orders[n] = o;
                saveState();
                updateSummary();
            });
            tdMenu.appendChild(item);

            if (state.store === "ì‹œê³¨ì»¤í”¼") {
                const tempRow = document.createElement("div");
                tempRow.className = "pill-row";
                state.menu.temps.forEach(t => tempRow.appendChild(createPill(t, o.temp === t, () => {
                    o.temp = t;
                    state.orders[n] = o;
                    saveState();
                    render();
                })));
                tdMenu.appendChild(tempRow);
            }

            tr.appendChild(tdMenu);

            const tdNotes = document.createElement("td");
            const notes = document.createElement("input");
            notes.type = "text";
            notes.className = "notes-input";
            notes.placeholder = "ë¹„ê³  (ì˜ˆ: ìƒ· ì¶”ê°€, ì‹œëŸ½ ë¹¼ê³ )";
            notes.value = o.notes;
            notes.addEventListener("input", () => {
                o.notes = notes.value;
                state.orders[n] = o;
                saveState();
                updateSummary();
            });
            tdNotes.appendChild(notes);
            tr.appendChild(tdNotes);

            tbody.appendChild(tr);
        });
    }

    function updateSummary() {
        const lines = [];
        const summaryCounts = new Map();
        const detailLines = [];
        let totalPrice = 0;

        NAMES.forEach(n => {
            const o = state.orders[n];
            if (o && o.cat !== "ë¯¸ì„ íƒ") {
                let menuName = o.cat;
                if (o.item) {
                    menuName = o.item;
                } else if (state.store === "ì‹œê³¨ì»¤í”¼" && o.temp !== "ë¯¸ì„ íƒ") {
                    menuName += ` (${o.temp})`;
                }
                
                if (state.store === "ì‹ ì†¡ì´ˆë°¥" && MENUS["ì‹ ì†¡ì´ˆë°¥"].prices[o.cat]) {
                    menuName += ` (${MENUS["ì‹ ì†¡ì´ˆë°¥"].prices[o.cat].toLocaleString()}ì›)`;
                }

                summaryCounts.set(menuName, (summaryCounts.get(menuName) || 0) + 1);

                if (state.store === "ì‹ ì†¡ì´ˆë°¥" && MENUS["ì‹ ì†¡ì´ˆë°¥"].prices[o.cat]) {
                    totalPrice += MENUS["ì‹ ì†¡ì´ˆë°¥"].prices[o.cat];
                }

                let detail = `${o.cat}`;
                if (o.item) detail = `${o.item}`;
                if (o.temp !== "ë¯¸ì„ íƒ") detail += ` (${o.temp})`;
                if (o.notes) detail += ` - ë¹„ê³ : ${o.notes}`;
                
                detailLines.push(`${n}: ${detail}`);
            }
        });
        
        lines.push(`ì£¼ë¬¸ (${new Date().toLocaleString()} / ${state.store})`);
        lines.push("--------------------------");
        
        lines.push(...detailLines);
        
        if (state.store === "ì‹ ì†¡ì´ˆë°¥" && totalPrice > 0) {
            lines.push("");
            lines.push(`ì´ ê¸ˆì•¡: ${totalPrice.toLocaleString()}ì›`);
        }
        
        lines.push("");
        lines.push("[ê°€ê²Œ ì „ë‹¬ ë©˜íŠ¸]");

        const orderedPeopleCount = detailLines.length;
        const unit = state.store === "ì‹ ì†¡ì´ˆë°¥" ? "ê°œ" : "ì”";
        const parts = Array.from(summaryCounts.entries()).map(([k, v]) => `${k} ${v}${unit}`);
        
        if (orderedPeopleCount > 0) {
            lines.push(`ì•ˆë…•í•˜ì„¸ìš”, ${parts.join(", ")} ë¶€íƒë“œë¦½ë‹ˆë‹¤. ì£¼ë¬¸ì€ ${orderedPeopleCount}ëª…ì…ë‹ˆë‹¤.`);
        } else {
            lines.push("ì•ˆë…•í•˜ì„¸ìš”, ì£¼ë¬¸ì„ ì·¨í•© ì¤‘ì…ë‹ˆë‹¤. ìµœì¢… ë‚´ì—­ì€ ê³§ ì „ë‹¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.");
        }
        
        summary.value = lines.join("\n");
    }
    
    function selectStore(storeName) {
        state.store = storeName;
        state.menu = MENUS[storeName];

        let newOrders = {};
        NAMES.forEach(n => newOrders[n] = { cat: "ë¯¸ì„ íƒ", item: "", temp: "ë¯¸ì„ íƒ", notes: "" });
        
        if (storeName === "ì‹œê³¨ì»¤í”¼") {
            newOrders["ìœ„ì›ì¥"] = { cat: "ì•„ë©”ë¦¬ì¹´ë…¸", item: "", temp: "ì•„ì´ìŠ¤", notes: "" };
            newOrders["ìœ ë™ì² "] = { cat: "ë ˆëª¬í‹°", item: "", temp: "í•«", notes: "" };
            newOrders["ìœ ì˜í˜„"] = { cat: "ì•„ë©”ë¦¬ì¹´ë…¸", item: "", temp: "ì•„ì´ìŠ¤", notes: "" };
            newOrders["ì´ìƒì¤€"] = { cat: "ì•„ë©”ë¦¬ì¹´ë…¸", item: "", temp: "ì•„ì´ìŠ¤", notes: "" };
            newOrders["ê³¼ì¥"] = { cat: "ë””ì¹´í˜ì¸", item: "", temp: "ì•„ì´ìŠ¤", notes: "" };
        }
        
        if (state.extraNames) {
            state.extraNames.forEach(name => {
                newOrders[name] = { cat: "ë¯¸ì„ íƒ", item: "", temp: "ë¯¸ì„ íƒ", notes: "" };
            });
        }
        
        state.orders = newOrders;
        
        saveState();
        storeEl.value = storeName;

        const storeButtons = document.querySelectorAll('#store-links .store-pill');
        storeButtons.forEach(btn => {
            btn.classList.remove('on');
        });
        document.getElementById(`${storeName === 'ì‹œê³¨ì»¤í”¼' ? 'sigolCoffeeBtn' : 'shinsongSushiBtn'}`).classList.add('on');


        sigolCoffeeButtons.style.display = storeName === "ì‹œê³¨ì»¤í”¼" ? 'flex' : 'none';
        shinsongSushiButtons.style.display = storeName === "ì‹ ì†¡ì´ˆë°¥" ? 'flex' : 'none';
        
        render();
    }

    state = loadState();

    storeEl.value = state.store;
    storeEl.addEventListener("input", () => {
        state.store = storeEl.value;
        saveState();
        updateSummary();
    });

    sigolCoffeeBtn.addEventListener("click", () => selectStore("ì‹œê³¨ì»¤í”¼"));
    shinsongSushiBtn.addEventListener("click", () => selectStore("ì‹ ì†¡ì´ˆë°¥"));
    shinsongSearchBtn.addEventListener("click", () => {
        const query = encodeURIComponent("ì‹ ì†¡ì´ˆë°¥ ë©”ë‰´");
        window.open(`https://m.search.naver.com/search.naver?query=${query}`, "_blank");
    });
    
    addPersonBtn.addEventListener("click", () => {
        newPersonInput.style.display = 'block';
        newPersonInput.focus();
    });

    newPersonInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
            const newName = newPersonInput.value.trim();
            if (newName && !NAMES.includes(newName)) {
                state.orders[newName] = { cat: "ë¯¸ì„ íƒ", item: "", temp: "ë¯¸ì„ íƒ", notes: "" };
                NAMES.push(newName);
                state.extraNames = state.extraNames || [];
                state.extraNames.push(newName);
                saveState();
                render();
                newPersonInput.value = "";
                newPersonInput.style.display = 'none';
            } else if (NAMES.includes(newName)) {
                alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤.");
            } else {
                newPersonInput.style.display = 'none';
            }
        }
    });

    resetBtn.addEventListener("click", () => {
        if (confirm("ì •ë§ë¡œ ëª¨ë“  ì£¼ë¬¸ ë‚´ì—­ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem(STORAGE_KEY);
            state = defaults();
            NAMES = [...DEFAULT_NAMES];
            storeEl.value = state.store;
            sigolCoffeeButtons.style.display = 'flex';
            shinsongSushiButtons.style.display = 'none';
            render();
        }
    });

    copyBtn.addEventListener("click", () => {
        const textToCopy = summary.value.split("[ê°€ê²Œ ì „ë‹¬ ë©˜íŠ¸]")[0].trim();
        navigator.clipboard.writeText(textToCopy)
            .then(() => alert("ì£¼ë¬¸ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"))
            .catch(err => console.error('ë³µì‚¬ ì‹¤íŒ¨:', err));
    });

    window.addEventListener('load', () => {
        if (state.extraNames) {
            NAMES = [...DEFAULT_NAMES, ...state.extraNames];
        }
        selectStore(state.store);
    });
})();
</script>
</body>
</html>